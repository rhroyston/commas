/*
    JavaScript Immediately-Invoked Function Expression (IIFE) to
    automatically format numbers as you type in an HTML text area
    of text input.  Attached to text area or text input by adding 
    class 'commas' to target element.
    
    (c) 2016, Ron Royston, MIT License
    https://rack.pub
*/

!function(){for(var a=document,b=a.getElementsByClassName("commas"),c=[],d=[],e="",f="",g="",h="",i="",j="",k=0,l=0;l<b.length;l++)b[l].addEventListener("keydown",function(){var a=event.keyCode;if(j=this.value,(8==a||46==a)&&(d=[],k=j.length-1,i=j.charAt(k),!isNaN(i)||","==i))for(var b=j.length-1;b>=0;b--){if(" "==j.charAt(b))return;if(isNaN(j.charAt(b))&&","!=j.charAt(b))return;d.push(j.charAt(b))}if(32==a&&d[1]){var c=d.reverse().slice(0,-1).join(""),e=c.replace(/\,/g,""),f=Number(e).toLocaleString().toString(),g=j.lastIndexOf(c);g>=0&&g+c.length>=j.length&&(j=j.substring(0,g)+f),this.value=j}}),b[l].addEventListener("keypress",function(){if(h=this.value.slice(-1),isNaN(h)){e=c.join(""),c=[],f=Number(e).toLocaleString().toString(),g=e+"(?!.*"+e+")",g=new RegExp(g);var a=this.value.replace(g,f);this.value=a}else{if(" "==h){e=c.join(""),c=[],f=Number(e).toLocaleString().toString(),g=e+"(?!.*"+e+")",g=new RegExp(g);var a=this.value.replace(g,f);return void(this.value=a)}c.push(h)}})}();